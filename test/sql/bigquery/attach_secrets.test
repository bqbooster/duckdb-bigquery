# name: test/sql/bigquery/attach_secrets.test
# description: Testing authentication with secrets and execution project
# group: [bigquery]

require bigquery

require-env BQ_TEST_SERVICE_ACCOUNT_JSON

require-env BQ_TEST_EXECUTION_PROJECT

require-env BQ_TEST_PROJECT

require-env BQ_TEST_DATASET

statement ok
CREATE SECRET duckdb_bigquery_secret (
    TYPE bigquery,
    service_account_json '${BQ_TEST_SERVICE_ACCOUNT_JSON}'
);

statement ok
ATTACH 'project=${BQ_TEST_PROJECT} execution_project=${BQ_TEST_EXECUTION_PROJECT} dataset=${BQ_TEST_DATASET}' AS bq (TYPE bigquery, SECRET duckdb_bigquery_secret);

statement ok
DROP TABLE IF EXISTS bq.${BQ_TEST_DATASET}.defaults_table;

statement ok
CREATE TABLE bq.${BQ_TEST_DATASET}.defaults_table (i INTEGER DEFAULT 5, s STRING DEFAULT 'some_default');
